# eth-io-server-standalone

> WE ARE (NOT) ALL ALONE

ì´ë”ë¦¬ì›€ io ì„œë²„ìž…ë‹ˆë‹¤.

>## ðŸ›‘[ê²½ê³ ]
>**ì´ ë¬¸ì„œëŠ” ë¶ˆì™„ì „ í•˜ë¯€ë¡œ ì‹¤ì œ ì‚¬ìš©ì‹œì—ëŠ” ì»¤ë¯¸í„°ì—ê²Œ ì¶©ë¶„í•œ ì„¤ëª…ì„ ìš”ì²­í•˜ì—¬ ì£¼ì˜ì‚¬í•­ì„ ì™„ì „ížˆ ìˆ™ì§€ í›„ ì‚¬ìš©í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.**

## íŠ¹ì§•
+ ëª¨ë“  ìš”ì²­ì„ ìˆœì°¨ì ìœ¼ë¡œ í•˜ë‚˜ì”© ì²˜ë¦¬í•©ë‹ˆë‹¤.
+ ì¤‘ì•™í˜•ì¼ ê²½ìš° ì´ë”, í† í° ë¶€ì¡± ì‹œ ê´€ë¦¬ìž ì£¼ì†Œì— ì¶©ì „ ë  ë•Œê¹Œì§€ ê³„ì† ëŒ€ê¸°í•©ë‹ˆë‹¤.
+ ë¶„ì‚°í˜•ì¼ ê²½ìš° ì´ë”, í† í° ë¶€ì¡± ì‹œ ì¤‘ë‹¨ë˜ë©° ë³µêµ¬ ì ˆì°¨ ìˆ˜í–‰ ì „ê¹Œì§€ í•´ë‹¹ ì£¼ì†Œê°€ ì‚¬ìš©ë¶ˆê°€ í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
+ ì´ë”ë¦¬ì›€ ê°€ìŠ¤ë¹„ 2 ~ 50 ì‚¬ì´ì—ì„œ ë„¤íŠ¸ì›Œí¬ ìƒíƒœì— ë”°ë¼ ìžë™ ì¡°ì ˆ. (ì¤‘ì•™í˜•ì¼ ê²½ìš° í† í° ìž…ê¸ˆì ˆì°¨ì— 0.005ETHë¥¼ ìž…ì¶œê¸ˆ)
+ infura ì„œë¹„ìŠ¤ì— ì—°ê²°í•˜ì—¬ ì‚¬ìš©í•˜ëŠ”ë° ìµœì í™” ë˜ì–´ ìžˆìŠµë‹ˆë‹¤.
+ ì´ë”ì™€ í† í°ì„ ì†Œìˆ˜ì  8ìžë¦¬ê¹Œì§€ë§Œ ì²˜ë¦¬í•©ë‹ˆë‹¤.

## ì‚¬ìš©ì ˆì°¨ (ìš°ë¶„íˆ¬ ë¦¬ëˆ…ìŠ¤ ê¸°ì¤€)
1. **/table**ì˜ sqlì„ ì°¸ê³ í•˜ì—¬ mysql DBì— í…Œì´ë¸” ìƒì„±
2. DBì˜ ì½”ì¸ ì •ë³´ ì„¤ì •
3. ```cp .env.example .env``` ëª…ë ¹ì–´ë¡œ íŒŒì¼ì„ ë³µì‚¬í•˜ì—¬ **.env** íŒŒì¼ ìƒì„± í›„ ì„¤ì •ìž…ë ¥
4. ì¤‘ì•™í˜•ì¼ ë•Œ ```cp event.example.js event.js``` ëª…ë ¹ì–´ë¡œ íŒŒì¼ì„ ë³µì‚¬í•˜ì—¬ **event.js** íŒŒì¼ ìƒì„± í›„ ìž…ê¸ˆ, ì¶œê¸ˆ ì»¨íŽŒ í›„ ì½œë°± ìž‘ì„±
5. ì˜ì¡´ì„± ì„¤ì¹˜
``` bash
# í•´ë‹¹ ìˆœì„œë¡œ ì‹¤í–‰ (I wish you good luck)
sudo apt install build-essential
sudo npm install -g node-gyp
sudo npm install
```
6. process.env.NODE_ENV ê°’ì„ ```development``` ë˜ëŠ” ```production```ìœ¼ë¡œ ì„¤ì • í›„ *pm2*ê°™ì€ í”„ë¡œì„¸ìŠ¤ ë§¤ë‹ˆì €ë¡œ ë°°í¬ í›„ ì‹¤í–‰

## .env íŒŒì¼ ì„¤ì •
+ ì„¤ì • ë³€ê²½ í›„ í”„ë¡œê·¸ëž¨ì„ ìž¬ì‹œìž‘í•´ì•¼ ì ìš©ë¨

| ì„¤ì •ëª… | ì„¤ëª… | ì˜ˆì‹œ | ê¸°íƒ€ |
| ---------- | ---------- | ---------- | ---------- |
| PORT | í¬íŠ¸ë²ˆí˜¸ | 8080 | |
| CENTRAL | ì¤‘ì•™í˜•/ë¶„ì‚°í˜• ì„ íƒ | true | ì¤‘ì•™í˜•ì´ë©´ true, ë¶„ì‚°í˜•ì´ë©´ false |
| INFURA_MAINNET | infura ë©”ì¸ë„· ì£¼ì†Œ | mainnet.infura.io/v3/4a8c... | mainnet |
| INFURA_TESTNET | infura í…ŒìŠ¤íŠ¸ë„· ì£¼ì†Œ | ropsten.infura.io/v3/4a8... | ropsten |
| DB_HOST_LOCAL | DB ì„œë²„ ì£¼ì†Œ | localhost ||
| DB_USER_LOCAL | DB ì‚¬ìš©ìž id | root ||
| DB_NAME_LOCAL | DB ìŠ¤í‚¤ë§ˆ ì´ë¦„ | eth_io_server ||
| DB_PASS_LOCAL | DB ë¹„ë°€ë²ˆí˜¸ | ******** ||
| ADMIN_ADDRESS | ê´€ë¦¬ìž ì£¼ì†Œ | 0x0384c89... | ì´ë”ë¦¬ì›€ ì£¼ì†Œ|
| ADMIN_PRIVATE | ê´€ë¦¬ìž ê°œì¸í‚¤ | 0x38f4c0a... | ðŸ›‘[ê²½ê³ ] **ì´ ê°’ì€ ì ˆëŒ€ë¡œ íƒ€ì¸ì´ë‚˜ ì™¸ë¶€ì— ë…¸ì¶œë˜ë©´ ì•ˆë©ë‹ˆë‹¤.** |
| MINIMUM_ETHER_AMOUNT_TO_DEPOSIT | ì¤‘ì•™í˜•ì—ì„œ ìž…ê¸ˆì²˜ë¦¬ ê°€ëŠ¥í•œ ìµœì†Œ ì´ë” ì•¡ìˆ˜ | 0.01 | ê°’ì´ ì‚¬ìš©ë˜ëŠ” ê°€ìŠ¤ë¹„ë³´ë‹¤ ì ìœ¼ë©´ ì˜¤ë¥˜ë°œìƒ |
| MINIMUM_TOKEN_AMOUNT_TO_DEPOSIT | ì¤‘ì•™í˜•ì—ì„œ ìž…ê¸ˆì²˜ë¦¬ ê°€ëŠ¥í•œ ìµœì†Œ í† í° ì•¡ìˆ˜ | 0.00000001 | ìž…ê¸ˆì²˜ë¦¬ ì‹œ ê´€ë¦¬ìž ì£¼ì†Œì— ì´ë” í•„ìš” |
| WITHDRAW_CONFIRM_COUNT | ì¶œê¸ˆ ì²˜ë¦¬ ì‹œ ì»¨íŽŒ íšŸìˆ˜ | 1 ||
| DEPOSIT_CONFIRM_COUNT | ìž…ê¸ˆ ì²˜ë¦¬ ì‹œ ì»¨íŽŒ íšŸìˆ˜ | 6 ||
| BALANCE_CHECK_INTERVAL | ì¤‘ì•™í˜•ì—ì„œ ìž…ê¸ˆì²˜ë¦¬ ì‹œ ìž”ì•¡ ì²´í¬ ê°„ê²© | 900 | ì´ˆë‹¨ìœ„ |
| REQUEST_CHECK_INTERVAL | ìž…ì¶œê¸ˆ ìš”ì²­ì²˜ë¦¬ ì‹œ DBì—ì„œ ìš”ì²­ ì²´í¬ ê°„ê²© | 15 | ì´ˆë‹¨ìœ„ |
| CONFIRM_CHECK_INTERVAL | ìž…ì¶œê¸ˆ ìš”ì²­ì²˜ë¦¬ ì²˜ë¦¬ í›„ ì»¨íŽŒ íšŸìˆ˜ ì²´í¬ ê°„ê²© | 60 | ì´ˆë‹¨ìœ„ |
| BALANCE_CHECK_CALL_TIMEOUT | ìž”ì•¡ ì²´í¬ ì‹œ ìš”ì²­ íƒ€ìž„ì•„ì›ƒ | 15 | ì´ˆë‹¨ìœ„. ðŸ›‘[ê²½ê³ ] **ë²„ê·¸ ë•Œë¬¸ì— ë°˜ë“œì‹œ ì ì ˆí•œ ê°’ì„ ìž…ë ¥í•´ì•¼ í•¨** |
| BALANCE_CHECK_CALL_TIMEWAIT | ìž”ì•¡ ì²´í¬ ì‹œ ìš”ì²­ì´ ì™„ë£Œë˜ëŠ” ì‹œê°„ ì§€ì—° | 1 | ì´ˆë‹¨ìœ„. 1ì´ˆë©´ ìš”ì²­ ì‹œìž‘ë¶€í„° ëê¹Œì§€ ìµœì†Œ 1ì´ˆ ê²½ê³¼ |

## ìžì£¼ ë³¼ ìˆ˜ ìžˆëŠ” ì—ëŸ¬ë“¤...
```
Error: Node error: {"code":-32000,"message":"missing trie node b12bae657657b1981...
```
ì •ìƒìž…ë‹ˆë‹¤.
```
Error: Web3 certain request timeout
```
ì •ìƒìž…ë‹ˆë‹¤.
```
Error: Node error: {"code":-32603,"message":"request failed or timed out"}
```
ëŒ€ë¶€ë¶„ì˜ ê²½ìš°ì— ì •ìƒìž…ë‹ˆë‹¤.
```
Error: Node error: {"code":-32000,"message":"insufficient funds for gas * price + value"}
```
ì´ë” ìž”ì•¡ ë¶€ì¡±. ì´ë”ë¥¼ ì¶©ì „í•  ë•Œê¹Œì§€ ê³„ì† ëŒ€ê¸°í•©ë‹ˆë‹¤.
```
Error: insufficient funds for token transfer
```
í† í° ìž”ì•¡ ë¶€ì¡±. í† í°ì„ ì¶©ì „í•  ë•Œê¹Œì§€ ê³„ì† ëŒ€ê¸°í•©ë‹ˆë‹¤.
```
Error: insufficient funds for transaction with fee
```
ì´ë” ìž”ì•¡ ë¶€ì¡±. ìˆ˜ìˆ˜ë£Œë¥¼ í¬í•¨í•˜ë©´ ì´ë” ì¶œê¸ˆì´ ë¶ˆê°€ëŠ¥í•  ì •ë„ë¡œ ì•¡ìˆ˜ê°€ ì ìŠµë‹ˆë‹¤.

> ì²˜ìŒ ë³´ëŠ” ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ê²½ìš° ì»¤ë¯¸í„°ì—ê²Œ ë¹ ë¥´ê²Œ ì—°ë½ë°”ëžë‹ˆë‹¤.

## ì¶œê¸ˆ ìš”ì²­
> Laravel ORM ê¸°ì¤€
``` php
// ìœ ì € ì¶œê¸ˆ ìš”ì²­
public function newWithdrawRequest($request_user_id, $request_address, $request_amount)
{
    DB::table('eth_io_request')
        ->insert([
            'in_progress' => 0,
            'request_type' => 'withdraw',
            'coin_kind' => $this->token,
            'request_user_id' => $request_user_id,
            'request_address' => $request_address,
            'request_amount' => $request_amount,
            'request_status' => 'withdraw_requested',
            'updated' => DB::raw('NOW()')
        ]);

    return;
}
```

